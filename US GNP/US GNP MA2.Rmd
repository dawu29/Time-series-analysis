---
title: "US GNP MA2"
author: "Dawu Liu"
output:
  html_document:
    df_print: paged
---

```{r global-options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```

```{r message = FALSE}
library(itsmr)
library(TSA)
data = read.delim("E:/2021 Fall/STAT 485/data/gnp-47-02D.txt", header = FALSE)
y = data$V1 - mean(data$V1)
```

__(a) Use the MLE to fit an MA(2) model.__

&nbsp;

__1. Read in the data__

__(a)__ Plot the data.

```{r fig.width=10,fig.height=5}
# 1(a)
plot(y, type="o", pch=16, col="cadetblue", xlab="Time(quater)", ylab="US GNP (billions)", 
     main="US GNP from 1947 (first quarter) to 2002 (third quarter) mean corrected")
```

&nbsp;

__(b)__ Use the plot to make a preliminary assessment of stationarity.

There appears to be a no trend in the data(maybe slightly upward but hard to tell). The variance doesn't vary much, there doesnâ€™t appear to be any periodicity/seasonality. The data might be stationary, or close to stationary.

&nbsp;

__(c)__ Plot the sample acf/pacf.

```{r fig.width=10,fig.height=5}
# 1(c)
par(mar=c(4,4,3,2), mfrow=c(1,2))
acf.sample = acf(y, lag.max = 40, plot = FALSE)
plot(acf.sample, ylim=c(-1,1), main="Sample ACF")
pacf.sample = pacf(y, lag.max = 40, plot = FALSE)
plot(pacf.sample, ylim=c(-1,1), main="Sample PACF")
```

&nbsp;

__(d)__ Use the plot to make observations about possible orders of dependency.

We can see the acf decays after lag > 0 in the sample ACF plot. The partial acf cuts off after lag = 2 in the sample PACF plot. After lag =2 , only 2 pacf are beyond the 95% CI. This might indicate the order of dependency is p=2, AR(2).

&nbsp;

__2. Estimate the parameters in the specified model using the specified method.__

```{r}
# 2 (a) (b)
ma2 = arima(y, order = c(0,0,2), method = "ML", include.mean = FALSE)
ma2
```

__(a)__ Give the estimated coefficients.

The estimated coefficients are: $\hat\theta_1 = 0.2937$, $\hat\theta_2 = 0.2222$, 
$\hat\sigma^2 = 1502.72$

&nbsp;

__(b)__ Give the value of the AIC or AICC.

The AIC value is 2258.11

&nbsp;

__(c)__ Plot the model and sample acf/pacf.

```{r fig.width=10,fig.height=5}
# 2 (c) 
ma2model.acf = ARMAacf(ma=c(ma2$coef[1], ma2$coef[2]),lag.max = 40, pacf = FALSE)
ma2model.pacf = ARMAacf(ma=c(ma2$coef[1],ma2$coef[2]),lag.max = 40, pacf = TRUE)
par(mar=c(4,4,3,2), mfrow=c(1,2))

ma2acf.sample = acf(y, lag.max = 40, plot = FALSE)
plot(ma2acf.sample, ylim=c(-1,1), lwd = 5, col="cadetblue", main="Sample ACF(Green) Model ACF(Red)")
points(ma2model.acf[-1], col="red", type="h", lwd = 2)

ma2pacf.sample = pacf(y, lag.max = 40, plot = FALSE)
plot(ma2pacf.sample, ylim=c(-1,1), lwd = 5, col="cadetblue", main="Sample PACF(Green) Model PACF(Red)")
points(ma2model.pacf, col="red", type="h", lwd = 2)
```

&nbsp;

__(d)__ Use the plot from (c) to assess the quality of the model fit.

The model acf/pacf don't fit the sample acf/pacf well. In the ACF plot, the model acf is smaller than sample acf at lag = 1 and 2. The model acf does not capture the significance of sample acf at lag = 3. In the PACF plot, at lag = 2, the sample pacf is still beyond the 95CI%, but the model pacf is inside the 95% CI. The model is not a good fit for the sample.

&nbsp;

__3. Analyze the standardized residuals.__

__(a)__ Plot the standardized residuals.

```{r fig.width=10,fig.height=5}
# 3 (a) 
ma2resid=rstandard(ma2)
plot(ma2resid, type="o", pch=15, xlab="Time", ylab="Residuals", main="Standardized Residuals")
```

&nbsp;

__(b)__ Plot the sample acf/pacf for the standardized residuals.


```{r fig.width=10,fig.height=5}
# 3 (b) 
par(mar=c(4,4,3,2), mfrow=c(1,2))
ma2acf.resid = acf(ma2resid, lag.max = 40, plot = TRUE, main="Residual ACF")
ma2pacf.resid = pacf(ma2resid, lag.max = 40, plot = TRUE, main="Residual PACF")
```

&nbsp;

__(c)__ Assess the plots for the hypothesis that the residuals are iid.

There is no pattern in the residuals plot. One acf is beyond the 95%CI in residual ACF plot and two(5%) pacf is beyond the residual PACF plot at lag >0. Both are reasonable number. We conclude that the plots support the hypothesis that residuals being iid. 

&nbsp;

__(d)__ Evaluate the Ljung-Box and McLeod-Li statistics and indicate if they support rejection of the
iid hypothesis.

```{r echo=TRUE}
# 3 (d) 
#Ljung-Box test
Box.test(ma2resid, lag = 20, type = "Ljung", fitdf = 0)$p.value
#McLeod-Li test
Box.test(ma2resid^2, lag = 20, type = "Ljung", fitdf = 0)$p.value
```

With lag = 20, the p-values for Ljung-Box and McLeod-Li statistical tests are 0.1254 and 3.38e-06 respectively. LB test fails to reject the iid hypothesis at level 0.05, and ML test supports the rejection of the iid hypothesis at level 0.05. 

&nbsp;

__(e)__ Give a final assessment on the validity of the iid hypothesis.

Plots in b) support the iid hypothesis, one test in d) fails to reject the iid hypothesis while another one supports the rejection of iid hypothesis, just pay attention that the p-value of Ljung-Box is not that large (0.12). The results don't reject the hypothesis that residuals being iid.  

&nbsp;

__4. Use the results to give a summary evaluation about the quality of the fitted model.__

The model acf/pacf don't fit the sample acf/pacf well, even though the residuals might behave like iid. The fitted MA(2) model is not a good fit for the data, it doesn't capture some of the siginificance of the sample acf/pacf at the first few lags. Perhaps try a different model would give better results. 

&nbsp;

The next method starts next page.

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}
```
